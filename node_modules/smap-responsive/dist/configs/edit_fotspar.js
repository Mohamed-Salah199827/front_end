
var ws = {
		"localhost": {
			proxy: "//localhost/cgi-bin/proxy.py?url="
		},
		"xyz.malmo.se": {
			proxy: "http://xyz.malmo.se/myproxy/proxy.py?url="
		},
		"kartor.malmo.se": {
			proxy: "http://kartor.malmo.se/cgi-bin/proxy.py?url="
		},
		"91.123.201.52": {
			proxy: "http://91.123.201.52/cgi-bin/proxy.py?url="
		},
		"mobile.smap.se": {
			proxy: "http://mobile.smap.se/smap-mobile/ws/proxy.py?url="
		}
};
var proxy = ws.hasOwnProperty(document.domain) ? ws[document.domain].proxy : null;


var config = {
	
	params: {
		center: [13.0212, 55.59387],
		zoom: 12
	},

	ws: ws,
	
	ol: [
			{
				init: "L.GeoJSON.WFS",
				url: "http://localhost/geoserver/wfs",
				options: {
					params: {
						typeName: "skane:POI_VARAFOTSPAR_PT",
					},
					displayName: "Våra fotspår",
					layerId: "guidelayer",
					xhrType: "POST",
					useProxy: false,
					attribution: "Malmö stad",
					inputCrs: "EPSG:4326",
					uniqueKey: "gid",
					selectable: true,
					isEditable: true,
					geomType: "POINT",
					reverseAxis: false,
					reverseAxisBbox: true,
					popup:
						'<h4>${gid}: ${title} </h4>'+
						'<div class="gp-mediaicons">${function(p) {'+
								'var out = "";'+
								'var style="margin-right:.3em;";'+
								'if (p.video) {'+
									'	out += \'<span style="\'+style+\'" class="fa fa-film fa-lg"></span>\';'+
									'}'+
								'if (p.audio) {'+
								'	out += \'<span style="\'+style+\'" class="fa fa-volume-up fa-lg"></span>\';'+
								'}'+
							'if (p.pics && p.pics.split(",").length > 1) {'+
							'	out += \'<span style="\'+style+\'" class="fa fa-picture-o fa-lg"></span>\';'+
							'}'+
						'return out;'+
						'}'+
						'}</div>'+
						'${function(p) {'+
								'var out = "";'+
								'var pics = p.pics || "",'+
									'pic;'+
								'pics = pics ? pics.split(",") : [];'+
								'if (pics.length > 1 && pics[0].length) {'+
									'pic = pics[0];'+
								'}'+
								'else if (pics.length === 1) {'+
									'pic = pics;'+
								'}'+
								'else {return "";}'+
								'pic = $.trim(pic);'+
								'return "<img style=\'width:100%;max-height:200px;margin-top: 1em;\' src=\'//xyz.malmo.se/rest/resources/vara_fotspar/"+pic+"\'></img>";'+
							'}}'
				}
			}
		],
		
	bl: [
			{
				init: "L.TileLayer",
				url: 'http://xyz.malmo.se/data_e/Tilecache/malmo/malmo_leaflet_cache_EPSG900913/{z}/{x}/{y}.jpeg',
				options: {
					layerId: "malmotile",
					displayName: "Malmö karta",
					attribution: "© Malmö Stadsbyggnadskontor",
					minZoom: 6,
					maxZoom: 18,
					tms: true
				}
			}
	],
	
	plugins: [
				// {
				// 	init: "L.Control.MalmoHeader",
				// 	options: {}
				// },
				{
					init: "L.Control.Scale",
					options: {
						imperial: false
					}
				},
				{
					init: "L.Control.LayerSwitcher",
					options: {}
				},
				{
					init: "L.Control.Editor",
					options: {
						useProxy: false
					}
				},
				{
					init: "L.Control.SelectWMS",
					options: {
						buffer: 5
					}
				},
//					{
//					init: "L.Control.SelectWMS",
//					options: {
//						buffer: 5
//					}
//					},
				{
					init: "L.Control.SelectVector",
					options: {
						buffer: 5
					}
				},
				{
					init: "L.Control.Zoombar",
					options: {}
				},
				{
					init: "L.Control.Geolocate",
					options: {}
				},
				{
					init: "L.Control.ShareLink",
					options: {
						addToMenu: false
					}
				},
				{
					init: "L.Control.GuideIntroScreen",
					options: {
						autoActivate: false
					}
				},
//						{
//							init: "L.Control.Menu",
//							options: {}
//						},
				{
					init: "L.Control.GuidePopup",
					options: {
						autoActivate: false,
						layerId: "guidelayer",
						dialogTitle: "${title}",
						useProxy: true,
						attrId: "gid",
						
						// This object specifies how to fill the big popup (the modal window).
						// The modalContent parameters can be overridden by individual parameters for each feature.
						modalContent: {
							iconType: null,
							dialogTitle: "${title}",
							fullScreenIntroPic: "${pics}", // Used only when clicking on a media tag, opening in fullscreen
							tabIntro: '${function(p) {'+
								'var out = "";'+
								'var pics = p.pics || "",'+
									'pic;'+
								'pics = pics ? pics.split(",") : [];'+
								'if (pics.length > 1 && pics[0].length) {'+
									'pic = pics[0];'+
								'}'+
								'else if (pics.length === 1) {'+
									'pic = pics;'+
								'}'+
								'else {return "";}'+
								'pic = $.trim(pic);'+
								'return "<img style=\'max-width:70%;max-height:300px;margin-bottom: 1em;\' src=\'//xyz.malmo.se/rest/resources/vara_fotspar/"+pic+"\'></img>";'+
							'}}'+
							"<div>${description}</div>",
							tabMedia: [{
								condition: function(p) {
									return p.pics && p.pics.split(",").length >= 1;
								},
								label: 'Bilder från "${title}"',
								mediaType: "image",
								sources: '${function(p){var pics = p.pics.split(","); '+
										'var baseUrl = "//xyz.malmo.se/rest/resources/vara_fotspar/";'+
										'var out = [];'+
										'for (var i=0,len=pics.length; i<len; i++) {'+
											'out.push(baseUrl + $.trim(pics[i]));'+
										'}'+
										'return out.join(",");'+
									'}}'
							},
							{
								condition: function(p) {
									return p.video && p.video.length > 0;
								},
								label: 'Kort video om "${title}"',
								mediaType: "video",
								sources: '${video}'
							}

							]
							// ,
							// tabAccess: '<div>'+

							// 	'<p>'+
							// 		'${function(p){var pics = p.pics && p.pics.length ? p.pics.split(",") : []; '+
							// 			'if (pics.length) {'+
							// 				'return "<img height=\'25%\' width=\'25%\' class=\'img-thumbnail\' src=\'//xyz.malmo.se/rest/resources/vara_fotspar/"+$.trim(pics[0])+"\'></img>";'+
							// 			'} else {return "";}'+
							// 		'}}'+
							// 	'"</p>'+
							// '</div>'
						},

						modalContentOverrides: {
							
						}
					}
				}
	]
};
