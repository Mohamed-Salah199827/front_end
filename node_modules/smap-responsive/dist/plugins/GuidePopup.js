!function(i){function e(o){if(t[o])return t[o].exports;var n=t[o]={exports:{},id:o,loaded:!1};return i[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var t={};return e.m=i,e.c=t,e.p="",e(0)}([function(i,e){"use strict";L.Control.GuidePopup=L.Control.extend({options:{},initialize:function(i){L.setOptions(this,i),this._setLang()},_lang:{sv:{introHeader:"Info",mediaHeader:"Media",accessHeader:"Tillgänglighet",close:"Stäng",showMore:"Visa mer",clickToSee:"Klicka för mer info",loadingPic:"Hämtar bild",tipClickForFullScreen:"Klicka för fullskärmsbild"},en:{introHeader:"About",mediaHeader:"Media",accessHeader:"Accessibility",close:"Close",showMore:"Read more",loadingPic:"Loading photo",clickToSee:"Click for more info",picFullScreenTitle:"Slideshow",tipClickForFullScreen:"Click for full-screen photo"}},_setLang:function(i){i=i||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[i]:null)},onAdd:function(i){this.map=i,this._container=L.DomUtil.create("div","leaflet-control-guidepopup"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.__onPopupClick=this.__onPopupClick||$.proxy(this._onPopupClick,this);var e=this;return e._activate(),this._container},onRemove:function(i){this._deactivate(),windowWidth<950?this.hideTheTag():this.showTheTag()},_onPopupClick:function(i){var e=$("#gp-btn-show").data("props"),t=this._getFeatureData(e[this.options.attrId]),o=t.tabMedia,n=t.tabIntro;if(n)this.createPopup(e);else if(o&&o instanceof Object){var a,s=this._makeMediaContent(o.mediaType,utils.extractToHtml(o.sources,e).split(","));"image"!==t.mediaType&&(a=utils.extractToHtml(t.fullScreenIntroPic,e)),this.showFullScreen(s,utils.extractToHtml(o.label,e),a)}return($(i.target).hasClass("gp-mediaicons")||$(i.target).parent().hasClass("gp-mediaicons"))&&$('[href="#gp-moreinfo"]').click(),!1},_onPopupOpen:function(i){if(i.popup._source&&i.popup._source.feature){var e=(i.popup._source.feature.layerId,i.popup._source.feature.properties);i.popup.options.autoPanPaddingTopLeft=[0,60],$(".leaflet-popup-content").find(".gp-mediaicons").on("touchstart click",this.__onPopupClick);var t=this._getFeatureData(e[this.options.attrId]);if(t&&t instanceof Object){var o=$('<button style="margin-top:10px;" id="gp-btn-show" class="btn btn-default">'+this.lang.showMore+"</button>");$(".leaflet-popup-content").append(o),o.data("props",e),o.on("touchstart click",this.__onPopupClick),$(".leaflet-popup-content img").on("touchstart click",this.__onPopupClick).css("cursor","pointer").tooltip({title:this.lang.clickToSee})}}},_onPopupClose:function(i){$(i.popup._wrapper).off("touchstart",this.onPopupClick)},_activate:function(){for(var i,e=this,t={audio:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/120-headphones.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})},video:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/46-movie-2.png",iconSize:[20,25],iconAnchor:[10,12],popupAnchor:[0,-9]})},image:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/121-landscape.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})}},t={audio:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/120-headphones.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})},video:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/46-movie-2.png",iconSize:[20,25],iconAnchor:[10,12],popupAnchor:[0,-9]})},image:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/121-landscape.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})}},o=smap.config.ol||[],n=0,a=o.length;a>n;n++)i=o[n].options,i.params&&i.params.q&&(i.pointToLayer=function(i,o){var n=i.properties||{},a=e.options.modalContentOverrides[n[e.options.attrId]]||{};a.tabMedia;return a.iconType&&t[a.iconType]?L.marker(o,t[a.iconType]):L.marker(o)});this.map.on("popupopen",this._onPopupOpen,this),this.map.on("popupclose",this._onPopupClose,this)},_deactivate:function(){this.map.off("popupopen",this.__onPopupOpen),this.map.off("popupclose",this.__onPopupClose)},_makeCarousel:function(i){i=i||[];for(var e,t=$('<div id="guide-carousel" class="carousel slide">'),o=$('<ol class="carousel-indicators" />'),n=$('<div class="carousel-inner" />'),a=$('<a class="left carousel-control" href="#guide-carousel" data-slide="prev"><span class="icon-prev"></span></a><a class="right carousel-control" href="#guide-carousel" data-slide="next"><span class="icon-next"></span></a>'),s=0,r=i.length;r>s;s++)e=i[s],o.append('<li data-target="#guide-carousel" data-slide-to="'+s+'"></li>'),n.append('<div class="item"><img src="'+e+'"></img></div>');return n.find(".item:first").add(o.find("li:first")).addClass("active"),t.append(n),i.length>1&&(t.prepend(o),t.append(a),t.swiperight(function(){$(this).carousel("prev")}).swipeleft(function(){$(this).carousel("next")})),$(document).on("orientationchange",function(){var i=window.innerHeight;$(".gp-fullscreen").height(i)}),t},_makeAudioTag:function(i){i=i||[];for(var e,t,o,n,a=$('<audio controls="controls" />'),s=0,r=i.length;r>s;s++){switch(e=i[s],t=e.substring(e.length-3).toUpperCase()){case"OGG":o="audio/ogg";break;case"MP3":o="audio/mpeg"}n='<source src="'+e+'" type="'+o+'" />',a.append(n)}return a},_makeVideoTag:function(i){i=i||[];var e=$(window).width()-2,t=$(window).height()-65;if(t>e){var o=e;e=t,t=o}t/=2,e/=2;var n,a=i[0];return a.search(/youtu.be|youtube/i)>-1?n=$('<iframe src="'+a+'?rel=0" width="100%" height="80%" frameborder="0" allowfullscreen></iframe>'):a.search(/vimeo.com/i)&&(n=$('<iframe src="'+a+'" width="100%" height="80%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')),n},_makeAccessContent:function(i){var e=this._getFeatureData(i[this.options.attrId]);return utils.extractToHtml(e.tabAccess,i)},_makeMediaList:function(i,e){if(i=i||[],!i.length)return null;var t,o,n,a={image:"fa fa-picture-o fa-lg",audio:"fa fa-volume-up fa-lg",video:"fa fa-film fa-lg"},s=$('<div id="gp-listmoreinfo" class="list-group" />');for(o=0,len=i.length;o<len;o++)t=i[o],(!t.condition||t.condition&&t.condition(e)===!0)&&(n=$('<a href="#" class="list-group-item"><span class="'+a[t.mediaType]+'"></span>&nbsp;&nbsp;&nbsp;'+utils.extractToHtml(t.label,e)+"</a>"),n.data("mediaType",o),s.append(n));return s.children().length?s:null},showFullScreen:function(i,e,t){function o(i){27===i.which&&n()}function n(){return $("body").off("keydown",o),$(".gp-fullscreen").removeClass("gp-fs-visible"),$(".gp-fullscreen").find("audio").each(function(){this.pause&&this.pause()}),setTimeout(function(){$(".gp-fullscreen").empty().remove()},500),!1}var a=$('<div class="gp-fullscreen"></div>');$("body").on("keydown",o);var s=$('<button type="button" class="btn btn-default">Stäng</button>');s.on("click",function(){return n(),!1});var r="<h1>"+e+"</h1>";if(a.append(r),t){var c=$('<img class="gp-mediapic" src="'+t+'" />');a.append(c)}a.append(i),a.append(s),s.css("z-index",3e3),$("body").append(a),setTimeout(function(){a.addClass("gp-fs-visible")},50)},_makeMediaContent:function(i,e){switch(i.toLowerCase()){case"image":content=this._makeCarousel(e);break;case"audio":content=this._makeAudioTag(e);break;case"video":content=this._makeVideoTag(e)}return content},_getFeatureData:function(i){var e=this.options.modalContentOverrides[i]||{};return $.extend(!0,{},this.options.modalContent||{},e)},createPopup:function(i){function e(e){var o,a=$(this).data("mediaType"),s=n.tabMedia[a],r=utils.extractToHtml(s.sources,i),c=t._makeMediaContent(s.mediaType,r.split(","));return"audio"===s.mediaType&&(o=utils.extractToHtml(n.fullScreenIntroPic,i)),t.showFullScreen(c,$(this).text(),o),!1}i=i||{};var t=this,o='<ul class="nav nav-tabs"><li class="active"><a href="#gp-intro" data-toggle="tab">'+this.lang.introHeader+'</a></li><li><a href="#gp-moreinfo" data-toggle="tab">'+this.lang.mediaHeader+'</a></li><li><a href="#gp-access" data-toggle="tab">'+this.lang.accessHeader+'</a></li></ul><div class="tab-content gp-popup"><div class="tab-pane active" id="gp-intro"></div><div class="tab-pane" id="gp-moreinfo"></div><div class="tab-pane" id="gp-access"></div></div>';o=$(o);var n=this._getFeatureData(i[this.options.attrId]),a=this._makeMediaList(n.tabMedia,i);a?o.find("#gp-moreinfo").append(a):o.find('[href="#gp-moreinfo"], #gp-moreinfo').remove();var s=this._makeAccessContent(i);s?o.find("#gp-access").append(s):o.find('[href="#gp-access"], #gp-access').remove();var r=utils.extractToHtml(n.dialogTitle||i[this.options.dialogTitle],i),c='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";if(this.dialog=utils.drawDialog(r,o,c),this.dialog.on("hidden.bs.modal",function(){$(this).empty().remove(),t.dialog=null,delete t.dialog}),this.dialog.attr("id","gp-popup"),this.dialog.find("#gp-listmoreinfo").find(".list-group-item").on("tap click",e),$("body").append(this.dialog),this.dialog.modal(),n.tabIntro){var p=utils.extractToHtml(n.tabIntro,i);if("HTTP"===p.substring(0,4).toUpperCase())this._getData(p,function(){$("#gp-intro").append(utils.extractToHtml($(this).html(),i)),smap.cmd.loading(!1)});else{var l=$("<div />").append(p);l.find("img").each(function(){utils.addImageLoadIndicator($(this),{height:"150px"})}),l.find("img").on("click tap",function(){var i=t._makeCarousel([$(this).prop("src")]);t.showFullScreen(i,r)}).prop("title",this.lang.tipClickForFullScreen).tooltip(),$("#gp-intro").append(l)}}},_getData:function(i,e){var t=$("<div />");smap.cmd.loading(!0),i=this.options.useProxy?smap.config.ws.proxy+encodeURIComponent(i):i,t.load(i,e)}}),L.control.guidePopup=function(i){return new L.Control.GuidePopup(i)}}]);