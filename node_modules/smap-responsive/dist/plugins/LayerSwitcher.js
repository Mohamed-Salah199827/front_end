!function(t){function i(e){if(n[e])return n[e].exports;var s=n[e]={exports:{},id:e,loaded:!1};return t[e].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}var n={};return i.m=t,i.c=n,i.p="",i(0)}([function(t,i){"use strict";L.Control.LayerSwitcher=L.Control.extend({options:{pxDesktop:992,toggleSubLayersOnClick:!1,unfoldOnClick:!0,olFirst:!1,unfoldAll:!1,btnHide:!0,zoomToExtent:!1,showTooltip:!1,hoverTooltip:!0,showTooltipOnCollapse:!1,catIconClass:"fa fa-chevron-right",getFitBoundsOptions:function(){var t={paddingTopLeft:[0,0]};return $(".lswitch-panel:visible").length&&(t.paddingTopLeft[0]=330),t}},_lang:{sv:{baselayers:"Bakgrundslager",overlays:"Kartskikt",close:"Stäng",hide:"Göm",btnHideTooltip:"Göm lagerväljaren",btnShowTooltip:"Visa lagerväljaren",layerSwitcher:"Lagerväljare",btnToggleTooltip:"Lagerväljare"},en:{baselayers:"Baselayers",overlays:"Overlays",close:"Close",hide:"Hide",btnHideTooltip:"Hide layer switcher",btnShowTooltip:"Show layer switcher",layerSwitcher:"Layer switcher",btnToggleTooltip:"Layer switcher"}},showLayer:function(t){return smap.core.layerInst.showLayer(t)},hideLayer:function(t){smap.core.layerInst.hideLayer(t)},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"sv",this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.lang)},onAdd:function(t){this.map=t,this._container=L.DomUtil.create("div","leaflet-control-LayerSwitcher"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.__onRowTap=this.__onRowTap||$.proxy(this._onRowTap,this),this.__onHeaderClick=this.__onHeaderClick||$.proxy(this._onHeaderClick,this),this.__onHeaderIconClick=this.__onHeaderIconClick||$.proxy(this._onHeaderIconClick,this),this.__onBtnDialogClick=this.__onBtnDialogClick||$.proxy(this._onBtnDialogClick,this),this.__onLegendEnter=this.__onLegendEnter||$.proxy(this._onLegendEnter,this),this.__onLegendLeave=this.__onLegendLeave||$.proxy(this._onLegendLeave,this);var i=this;if(this._moveWithCursor=function(t){$("body").find(".lswitch-legend-big").length||$("body").append(i._hoverImg),$(".lswitch-legend-big").css({left:t.pageX+10+"px",top:t.pageY-30+"px"})},this._addPanel(),this._addLayers(smap.config.bl,smap.config.ol),this.options.startOpened=!1,this.options.startOpened){var n=$("#lswitch-olcont, #lswitch-blcont");1===this.options.startOpened?n.children(".lswitch-cat").click():2===this.options.startOpened?n.children(".lswitch-cat").next().find(".lswitch-cat").click():this.options.startOpened===!0&&n.find(".lswitch-cat").click()}if(this._addBtn(),this._bindEvents(),$("#mapdiv").addClass("lswitch-panelslide"),L.Browser.android){var e=function(t){var i=0;$(t).on("touchstart",function(t){i=this.scrollTop+t.originalEvent.touches[0].pageY}),$(t).on("touchmove",function(t){this.scrollTop=i-t.originalEvent.touches[0].pageY})};e($(".lswitch-panel"))}return this._container},onRemove:function(t){},_addLayers:function(t,i){t=t||[],i=i||[];var n;if(t.length>1)for(var e=0,s=t.length;s>e;e++)n=t[e],n.options.isBaseLayer=!0,this._addRow(n);else $(".lswitch-panel-bl").hide();if(i.length>0)for(var e=0,s=i.length;s>e;e++)n=i[e],n.options.isBaseLayer=!1,n.options.showInLayerSwitcher!==!1&&this._addRow(n);else $(".lswitch-panel-ol").hide();t.length<=1&&0===i.length&&$(".lswitch-panel span").css("color","#fff"),this._setSwitcherPosition(),this.__setSwitcherPosition=this.__setSwitcherPosition||$.proxy(this._setSwitcherPosition,this),$(window).on("resize",this.__setSwitcherPosition)},_setSwitcherPosition:function(){var t=0,i=$(".lswitch-panel");i.children().each(function(){t+=$(this).outerHeight()}),t>$("#mapdiv").innerHeight()-utils.rmPx(i.css("padding-top")+20)?i.css("position","absolute"):i.css("position","relative");var n=utils.getBrowser();n.ie&&i.css("position","absolute"),utils.isTouchOnly()||n.ie&&n.ieVersion<=8||this.hidePanel(),$("#lswitch-btn:visible").length&&this.options.showTooltipOnCollapse&&!this._btnToggleTooltipShown&&this._showBtnTooltip(this.lang.btnToggleTooltip,this.options.optionShowTooltip)},_bindEvents:function(){var t=this;$("#mapdiv").on("touchstart click",$.proxy(function(){return $(window).width()<this.options.pxDesktop?(this.hidePanel(),!1):void 0},this));var i=($.proxy(this.showPanel,this),$.proxy(this.hidePanel,this));utils.isTouchOnly()&&$(window).on("orientationchange",function(){t.$panel.is(":visible")&&i()}),this.map.on("layeradd layerremove",function(i){var n=i.layer||{};if(n.options&&!n.options._silent&&n.options.layerId&&!n.feature){var e=n.options.layerId,s=t._makeId(e),o=$("#"+s),a=o.hasClass("active");o.length&&("layeradd"===i.type&&a===!1?t.onRowTap(o):"layerremove"===i.type&&a===!0&&t.onRowTap(o))}}),smap.event.on("smap.core.createparams",function(t,i){var n=smap.core.paramInst.getParams();n.LSW&&(i.lsw=n.LSW)});var n=function(){if($(window).width()>t.options.pxDesktop)return!1;var i=smap.core.paramInst.getParams();i.LSW&&1===parseInt(i.LSW)&&setTimeout(function(){$("#lswitch-btn").trigger("mousedown")},310)};smap.event.on("smap.core.pluginsadded",n)},_addBtn:function(){var t=$('<div id="lswitch-btn" class="lswitch-btn-outslided"><span class="fa fa-angle-right"></span></div>');$("#mapdiv").prepend(t),t.on("mousedown "+L.DomEvent._touchstart,$.proxy(function(){if(!this._panelIsSliding){var t=$(".lswitch-panel").hasClass("panel-visible");t?this.hidePanel():this.showPanel()}return!1},this)),t.on("dblclick",function(){return!1}),this.options.hoverTooltip&&!utils.isTouchOnly()&&(t.on("mouseenter",function(){this._isHoveringToggleBtn=!0,this._bindToggleBtnPopover(this.lang.btnToggleTooltip),$("#lswitch-btn").tooltip("show")}.bind(this)),t.on("mouseleave",function(){$("#lswitch-btn").tooltip("hide"),this._isHoveringToggleBtn=!1}.bind(this)));var i=this,n=this.options.showTooltip||!1,e=this.lang.btnToggleTooltip;setTimeout(function(){$("#lswitch-btn").removeClass("lswitch-btn-outslided"),n&&i._showBtnTooltip(e,n)},800)},_bindToggleBtnPopover:function(t){$("#lswitch-btn").data("bs.tooltip")||$("#lswitch-btn").tooltip({title:t,trigger:"manual",placement:"right"})},_showBtnTooltip:function(t,i){if($("#lswitch-btn:visible").length){this._btnToggleTooltipShown=!0;var n=this;setTimeout(function(){n._isHoveringToggleBtn||(n._bindToggleBtnPopover(t),$("#lswitch-btn").tooltip("show"),setTimeout(function(){n._isHoveringToggleBtn||$("#lswitch-btn").tooltip("destroy")},"number"==typeof i?i:3e3))},1e3)}},_addPanel:function(){var t=this,i=this;if(this.$panel=$('<div class="lswitch-panel unselectable" />'),this.$panel.on("swipeleft",$.proxy(function(){this.hidePanel()},this)),this.$panel.on("touchstart",function(){$(this).css("overflow-y","auto")}),this.$list=$('<div class="panel panel-default lswitch-panel-bl"><div class="panel-heading"><span>'+this.lang.baselayers+'</span></div><div id="lswitch-blcont" class="list-group"></div></div><div class="panel panel-default lswitch-panel-ol"><div class="panel-heading"><span>'+this.lang.overlays+'</span></div><div id="lswitch-olcont" class="list-group"></div></div>'),this.$panel.append(this.$list),this.options.olFirst&&this.options.olFirst===!0&&this.$panel.prepend(this.$panel.find(".lswitch-panel-ol")),this.options.btnHide){var n,e,s;!function(){var o=function(t,i){t.tooltip("destroy"),$(".tooltip").remove(),t.prop("title",i),t.tooltip({placement:"right",text:i,container:"#maindiv"})};n=$('<button title="'+t.lang.btnHideTooltip+'" type="button" class="lswitch-btnhide btn btn-default"><i class="fa fa-chevron-down"></i></button>'),t.$panel.find(".panel-heading:first").append(n),o(n,t.lang.btnHideTooltip),e=n.parent().text(),s=!1,n.on("tap click",function(){var t=$(this);if(s)return!1;var n="rotate-90",a=t.find("i");return a.hasClass(n)?(a.removeClass(n),$(".lswitch-panel").removeClass("lswitch-displaynone"),t.prev().text(e),setTimeout(function(){$(".lswitch-panel").removeClass("lswitch-hidden")},1),o(t,i.lang.btnHideTooltip)):(s=!0,a.addClass(n),$(".lswitch-panel").addClass("lswitch-hidden"),o(t,i.lang.btnShowTooltip),t.prev().text(i.lang.layerSwitcher),setTimeout(function(){$(".lswitch-panel").addClass("lswitch-displaynone"),s=!1},200)),!1})}()}$("#maindiv").append(this.$panel)},showPanel:function(){var t=this;if(this.$panel.show(),this._panelIsSliding)return!1;this._panelIsSliding=!0,$("#lswitch-btn span").addClass("lsw-angle-turned"),setTimeout(function(){$(".lswitch-panel").addClass("panel-visible")},1),setTimeout(function(){t._panelIsSliding=!1},300),$("#mapdiv").addClass("mapdiv-slidetransition"),$("#maindiv").addClass("lswitcher-slidetransition");var i=this.$panel.outerWidth();$("#mapdiv").css({"margin-left":i+"px",width:$("#mapdiv").outerWidth()-i+"px"})},hidePanel:function(){return this._panelIsSliding?!1:(this._panelIsSliding=!0,$("#lswitch-btn span").removeClass("lsw-angle-turned"),$("#mapdiv").css({"margin-left":"0",width:"100%"}),$(".lswitch-panel").removeClass("panel-visible"),$("#maindiv").addClass("lswitch-overflow-hidden"),$("#maindiv").removeClass("lswitcher-slidetransition"),void setTimeout($.proxy(function(){$("#mapdiv").removeClass("mapdiv-slidetransition"),this._panelIsSliding=!1,this.$panel.hide(),$("#maindiv").removeClass("lswitch-overflow-hidden")},this),300))},_setBaseLayer:function(t){var i,n=this.map._layers;for(var e in n)i=n[e],i&&i.options&&i.options.isBaseLayer&&i.options.layerId!==t&&this.hideLayer(i.options.layerId);this.showLayer(t)},_onLegendClick:function(t){return $(this).parent().trigger("tap"),!1},_onRowTap:function(t){var i=$(t.target);return i.hasClass("list-group-item")?(this.onRowTap(i),!1):void 0},onRowTap:function(t){var i=t.attr("id"),n=this._unMakeId(i),e=$("#"+i).parents("#lswitch-blcont").length>0;if(e)return $("#lswitch-blcont").find("a.active").removeClass("active"),t.addClass("active"),this._setBaseLayer(n),!1;t.toggleClass("active");var s=t.hasClass("active"),o=t.parents(".lswitch-catcont");o.each(function(){if(s)$(this).prev().addClass("active");else{if($(this).find("a.list-group-item.active").length>0)return!1;$(this).prev().removeClass("active")}});var a,s=t.hasClass("active");if(s){var l=t.data("t")||null;a=this.showLayer(l||n);var r=this.options.getFitBoundsOptions?this.options.getFitBoundsOptions():null;(this.options.zoomToExtent||l&&l.options&&l.options.zoomToExtent)&&!this._sumBounds&&a.getBounds&&($.isEmptyObject(a._layers)?a.once("load",function(t){t.layer._map.fitBounds(a.getBounds(),r)}):this.map.fitBounds(a.getBounds(),r))}else this.map.closePopup(),a=this.hideLayer(n);return a},_makeId:function(t){return"lswitchrow-"+encodeURIComponent(t).replace(/%/g,"--pr--")},_unMakeId:function(t){return decodeURIComponent(t.replace("lswitchrow-","").replace(/--pr--/g,"%"))},_toggleHeader:function(t){t.next().toggleClass("lswitch-catcont-visible"),t.toggleClass("open")},_onHeaderClick:function(t,i){i=i||{};var n=this,e=t.target;e="A"===e.tagName||"SPAN"===e.tagName?$(e).parent():$(e);var s=e.next();if(!this.options.unfoldOnClick||!this.options.unfoldAll&&i.isSubHeader||this._toggleHeader(e),!this.options.toggleSubLayersOnClick&&this.options.unfoldOnClick&&this.options.unfoldAll&&s.find("div.list-group-item").each(function(){h=$(this);var t=e.hasClass("open"),i=h.hasClass("open");t!==i&&n._toggleHeader(h)}),this.options.toggleSubLayersOnClick&&0===e.parents("#lswitch-blcont").length){var o,a,l=e.hasClass("active"),r=e.hasClass("open");this.options.unfoldOnClick&&r===l&&!i.isSubHeader?l=!l:e.toggleClass("active");var d,c;this._sumBounds=null,!this.options.zoomToExtent||l||this._sumBounds||(d=$.Deferred(),d.done(function(){n._sumBounds.isValid()&&n.map.fitBounds(n._sumBounds,n.options.getFitBoundsOptions?n.options.getFitBoundsOptions():null),n._rowCount=null,n._sumBounds=null}),this._rowCount=this._rowCount||s.find("a.list-group-item").length,this._sumBounds=L.latLngBounds([]),c=function(t,i){this._rowCount-=1,this._sumBounds.extend(t.getBounds()),0===this._rowCount&&i.resolve()}),s.children(".list-group-item").each(function(){if(a=$(this),o=a.hasClass("active"),"A"===a[0].tagName&&l===o){var t=n.onRowTap(a);n._sumBounds&&t.getBounds&&($.isEmptyObject(t._layers)===!0?t.once("load",function(){c.call(n,t,d)}):c.call(n,t,d))}else"DIV"===a[0].tagName&&l===o&&n._onHeaderClick({target:a},{isSubHeader:!0})})}return $(window).width()>this.options.pxDesktop?this._setSwitcherPosition():$(".lswitch-panel").css("position","absolute"),!1},_onHeaderIconClick:function(t){var i=$(t.target);return this._toggleHeader(i.parent()),!1},_onBtnDialogClick:function(t){var i=$(t.target).parents(".list-group-item:first").data("t").options,n="",e=i.dialog;("http"===e.substring(0,4)||"//"===e.substring(0,2))&&(n='<div class="modal-body-container"><iframe frameborder="0" scrolling="auto" src="'+e+'" width="100%" height="100%" style="position:absolute;left:0;top:0;margin:0;padding:0;" frameborder="0"></iframe></div>');var s='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>",o=utils.drawDialog(i.displayName,n,s,{});o.addClass("lswitch-dialog"),o.modal("show");var a=$("#mapdiv").height();return a=a>500?500:a,o.find(".modal-body").css({"min-height":a+"px"}),o.on("hidden.bs.modal",function(){$(this).empty().remove()}),!1},_addBtnDialog:function(t,i){var n=$('<span class="fa fa-info-circle lswitch-btndialog" aria-hidden="true"></span>');n.on("click touchstart",this.__onBtnDialogClick),t.prepend(n)},_addLegend:function(t,i){var n=$('<img class="lswitch-legend" src="'+i+'" />');n.on("tap",this._onLegendClick).on("mouseenter",this.__onLegendEnter).on("mouseleave",this.__onLegendLeave),t.prepend(n)},_onLegendLeave:function(){$(".lswitch-legend-big").remove(),$(document).off("mousemove",this._moveWithCursor)},_onLegendEnter:function(t){var i=$(t.target),n=i.parent().data("t"),e=n.options.legendBig||n.options.legend;$(".lswitch-legend-big").remove(),delete this._hoverImg;var s=$('<img class="lswitch-legend-big" src="'+e+'" />');this._hoverImg=s,$(document).on("mousemove",this._moveWithCursor)},_addRow:function(t){var i=this.options.catIconClass,n=this,e=t.options,s=$('<a class="list-group-item">'+e.displayName+"</a>");s.attr("id",this._makeId(e.layerId)),s.on("tap",this.__onRowTap),s.data("t",t),!e.legend||utils.isTouchOnly()&&$(window).width()<this.options.pxDesktop||this._addLegend(s,e.legend),e.dialog&&this._addBtnDialog(s,t);var o;if(e.isBaseLayer?(o=$("#lswitch-blcont"),o.is(":visible")||$(".lswitch-panel-bl").show()):(o=$("#lswitch-olcont"),o.is(":visible")||$(".lswitch-panel-ol").show()),e.category){var a,l,r,h;!function(){var t=function d(t,e,o){return h=t[e],l=o.find('.lswitch-cat:has(span:contains("'+h+'"))'),l.length?r=l.next():(l=$('<div class="list-group-item lswitch-cat"><i class="'+i+'"></i><span>'+h+"</span></div>").appendTo(o),r=$('<div class="lswitch-catcont"></div>'),l.after(r),l.on("tap",n.__onHeaderClick),l.find("i").on("tap",n.__onHeaderIconClick)),t.length>e+1?d(t,e+1,r):(r.append(s),!0)};a=e.category,t(a,0,o)}()}else o.append(s);return s}}),L.control.layerSwitcher=function(t){return new L.Control.LayerSwitcher(t)}}]);